version: 2.1

shared: &shared
  steps:

    - restore_cache:
        keys:
          - source-v1-{{ .Branch }}-{{ .Revision }}
          - source-v1-{{ .Branch }}-
          - source-v1-
    - checkout
    - save_cache:
        key: source-v1-{{ .Branch }}-{{ .Revision }}
        paths:
          - ".git"

    - restore_cache:
        keys:
          # when lock file changes, use increasingly general patterns to restore cache
          - gradle-v1-{{ .Branch }}-{{ checksum "build.gradle" }}
          - gradle-v1-{{ .Branch }}-
          - gradle-v1-

    - run: ./gradlew build javadoc
    - run: ./gradlew requireJavadoc

    - save_cache:
        paths:
          - ~/.gradle
        key: gradle-v1-{{ .Branch }}-{{ checksum "build.gradle" }}

jobs:
  jdk8:
    docker:
      - image: circleci/openjdk:8-jdk
    <<: *shared
  jdk11:
    docker:
      - image: circleci/openjdk:11-jdk
    <<: *shared

workflows:
  version: 2
  build:
    jobs:
      - jdk8
      - jdk11
